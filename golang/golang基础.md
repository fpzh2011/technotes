# Go语言基础

Go是一门编译型语言，而且是静态编译（[3]，CH1.1）。

Go语言的代码通过包（package）组织，包类似于其它语言里的库（libraries）或者模块（modules）。一个包由位于单个目录下的一个或多个.go源代码文件组成, 目录定义包的作用。每个源文件都以一条package声明语句开始（[3]，CH1.1）。

main包比较特殊。它定义了一个独立可执行的程序，而不是一个库。在main包里的main函数也很特殊，它是整个程序执行时的入口（[3]，CH1.1）。

Go语言不需要在语句或者声明的末尾添加分号，除非一行上有多条语句。实际上，编译器会主动把特定符号（应该不包括花括号）后的换行符转换为分号, 因此换行符添加的位置会影响Go代码的正确解析（[3]，CH1.2）。

Go语言不允许使用无用的局部变量（local variables），因为这会导致编译错误。

## 帮助

```
go doc text/template
```


## 变量

### 命名

关键字列表（[3]，CH2.1）。
一个名字如果是在函数外部定义，那么将在当前包的所有文件中都可以访问（[3]，CH2.1）。
名字的开头字母的大小写决定了名字在包外的可见性。如果一个名字是大写字母开头的，那么它将是导出的，也就是说可以被外部的包访问（[3]，CH2.1）。
在习惯上，Go语言程序员推荐使用 驼峰式 命名

### 声明

Go语言主要有四种类型的声明语句：var、const、type和func，分别对应变量、常量、类型和函数实体对象的声明（[3]，CH2.2）。
包一级的各种类型的声明语句的顺序无关紧要（译注：函数内部的名字则必须先声明之后才能使用）。（[3]，CH2.2）

### 变量

如果初始化表达式被省略，那么将用零值初始化该变量。 数值类型变量对应的零值是0，布尔类型变量对应的零值是false，字符串类型对应的零值是空字符串，接口或引用类型（包括slice、map、chan和函数）变量对应的零值是nil。数组或结构体等聚合类型对应的零值是每个元素或字段都是对应该类型的零值。（[3]，CH2.3）
**在Go语言中不存在未初始化的变量。**（[3]，CH2.3）

一行语句可以声明多个类型不同的变量（[3]，CH2.3）：
```go
var b, f, s = true, 2.3, "four" // bool, float64, string
```

在包级别声明的变量会在main入口函数执行前完成初始化，局部变量将在声明语句被执行到的时候完成初始化。一组变量也可以通过调用一个函数，由函数返回的多个返回值初始化。（[3]，CH2.3）

在函数内部，`:=`可以不带`var`关键字，但是需要在声明同时初始化（[3], P5）。
简短变量声明左边的变量可能并不是全部都是刚刚声明的。如果有一些已经在相同的词法域声明过了，那么简短变量声明语句对这些已经声明过的变量就只有赋值行为了。如果变量是在外部词法域声明的，那么简短变量声明语句将会在当前词法域重新声明一个新的变量。（[3]，CH2.3.1）

### 指针

Go语言提供了指针。&操作符可以返回一个变量的内存地址，并且*操作符可以获取指针指向的变量内容，但是在Go语言里没有指针运算，也就是不能像c语言里可以对指针进行加或减操作（[3],CH1.8）。

即使变量由表达式临时生成，那么表达式也必须能接受&取地址操作。（[3]，CH2.3.2）

指向struct的指针p，可以直接用`.`访问成员变量，如`p.value = 1`。

rp util.Hash 如果对传入的string进行修改，会影响原来的string对象吗？？？？？？？？？？？？（[1]，P108）



## 值还是引用？

### 值保存方式

一般变量都是值保存方式，如int等。

数组、struct等也是值保存方式。

### 引用保存方式

map、slice切片、接口等都是引用保存方式。（[1]，P108，P113；[2] P66）


问题？？？？？？？？？？？？？？？？？？？？
查询一个map，返回的value也是引用方式吗？？？？？（rule.go中的CreateBranch函数，是因为value是指针类型。如果是struct呢，如果是int呢）
比如可以直接操作：`mymap["abc"] = 123`，这个是另一种情况？




### 垃圾回收

Go语言没有析构函数。在函数中定义的Constructors and composite literals，其地址可以作为函数返回值。如果没有其它变量引用了，由运行时自动回收、释放。
Go语言规范中并没有提及Stack和Heap的概念。编译器可以判断是应该放在栈中，还是放到Heap中；或者，可能每次对复合变量取地址，都会生成一个新的实例？
参考：
	https://golang.org/doc/effective_go.html#composite_literals
	http://stackoverflow.com/questions/10866195/stack-vs-heap-allocation-of-structs-in-go-and-how-they-relate-to-garbage-collec


## 切片Slice

切片是Go语言的基础概念（[3], P4）。


## 数据封装

Go没有`public private`等数据可见性的修饰关键字。要使某个符号对其它包可见，需要将该包定义为大写字母开头。Go语言中符号的可访问性是包一级，而不是类型一级的。（[2] P71）

## 程序结构

if、for等语句，条件等可以不必用括号封起来。当然，如果避免误输入，封起来也是可以得。

### if

Go语言允许在if语句的条件中先赋值，再进行条件判断，这样err的生命周期仅在if语句内（[3],CH1.7）。

```go
if err := r.ParseForm(); err != nil {
	log.Print(err)
}
```

### for 

for循环有多种形式（[3],CH1.2）。如果连condition也省略了，这就变成一个无限循环。initalization如果存在，必须是一条简单语句（simple statement），即，短变量声明、自增语句、赋值语句或函数调用。
```go
for initialization; condition; post {
    // zero or more statements
}
for condition {
    // ...
}
for {
    // ...
}
for _, arg := range os.Args[1:] {
}
```

### switch

Go语言并不需要显式地在每一个case后写break，语言默认执行完case后的逻辑语句会自动退出（[3],CH1.8）。
Go语言里的switch还可以不带操作对象（译注：switch不带操作对象时默认用true值代替，然后将每个case的表达式和true值进行比较）；可以直接罗列多种条件，像其它语言里面的多个if else一样，下面是一个例子：
```go
func Signum(x int) int {
	switch {
	case x > 0:
		return +1
	default:
		return 0
	case x < 0:
		return -1
	}
}
```
switch也可以紧跟一个简短的变量声明，一个自增表达式、赋值语句，或者一个函数调用。


## 常用包

### 字符串操作

```go
strings.Join //连接字符串（[3],CH1.2）
```

### I/O

```go
bufio.NewScanner //按行扫描。可以通过Split函数指定分隔方法（[3],CH1.2）。
fmt //格式化io（[3],CH1.2）
fmt.Printf("%d\t%s\n", n, line)
io.Copy
ioutil.Discard //类似/dev/null
```



## 代码格式

Go语言不需要在语句或者声明的末尾添加分号，除非一行上有多条语句。（[3], P3）
实际上，编译器会主动把特定符号后的换行符转换为分号, 因此换行符添加的位置会影响Go代码的正确解析（[3], P3）。
举个例子, 函数的左括号`{`必须和`func`函数声明在同一行上, 且位于末尾，不能独占一行。




用缩进表示代码结构？？？

函数的多个返回值。

## 类与面向对象

Go不支持继承，没有类的层次结构。甚至没有“类”，通过Composition组合来构造复杂对象（[3] Preface, xv）。

方法不仅可以定义在结构体上, 而且, 可以定义在任何用户自定义的类型上；并且, 具体类型和抽象类型（接口）之间的关系是隐式的，所以很多类型的设计者可能并不知道该类型到底实现了哪些接口。

## 包管理

Go语言的代码通过包（package）组织，包类似于其它语言里的库（libraries）或者模块（modules）。（[3], P2）

Go的包可以有目录层次。

代码开始的`package main`表示该文件属于哪个包。

`import`声明导入需要的包。但**如果导入了不需要的包**，程序也会无法编译通过。（[3], P3）
import声明必须跟在文件的package声明之后。

`main`包比较特殊。它定义了一个独立可执行的程序，而不是一个库。
在main包里的 main 函数也很特殊，它是整个程序执行时的入口。（[3], P2）

包导入顺序并不重要；gofmt工具格式化时按照字母顺序对包名排序（[3], P4）。

包导入有两种形式：
```go
import (
	"fmt"
	"os"
)
```

或
```go
import fmt
import os
```

按照惯例，我们在每个包的包声明前添加注释（[3], P5）。

## 运行、编译

`go run my.go`
这个命令编译一个或多个以.go结尾的源文件，链接库文件，并运行最终生成的可执行文件。但该可执行文件不会保存下来。

`go build my.go`
这个命令生成并保存可执行的二进制文件。

## 命令行参数

os.Args变量是一个字符串（string）的切片（[3], CH1.2, P4）。
os.Args的第一个元素，os.Args[0], 是命令本身的名字；其它的元素则是程序启动时传给它的参数。


## 问题

struct与class的区别是什么？有class关键字吗？


## 参考资料

[1] Go语言程序设计
[2] Go语言编程，许式伟
[3] The Go Programming Language （https://docs.ruanjiadeng.com/gopl-zh/ch1/ch1-01.html）
